<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial 2 · TrixiCUDA.jl</title><meta name="title" content="Tutorial 2 · TrixiCUDA.jl"/><meta property="og:title" content="Tutorial 2 · TrixiCUDA.jl"/><meta property="twitter:title" content="Tutorial 2 · TrixiCUDA.jl"/><meta name="description" content="Documentation for TrixiCUDA.jl."/><meta property="og:description" content="Documentation for TrixiCUDA.jl."/><meta property="twitter:description" content="Documentation for TrixiCUDA.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">TrixiCUDA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../aws_gpu_setup/">Tutorial 1</a></li><li class="is-active"><a class="tocitem" href>Tutorial 2</a><ul class="internal"><li><a class="tocitem" href="#Create-Profile"><span>Create Profile</span></a></li><li><a class="tocitem" href="#View-Profile"><span>View Profile</span></a></li><li><a class="tocitem" href="#View-Profile-(Optional)"><span>View Profile (Optional)</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial 2</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial 2</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/trixi-gpu/TrixiCUDA.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/trixi-gpu/TrixiCUDA.jl/blob/main/docs/src/nsys_profiling.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial-2-Profiling-Kernels-with-Nvidia-Night-Systems"><a class="docs-heading-anchor" href="#Tutorial-2-Profiling-Kernels-with-Nvidia-Night-Systems">Tutorial 2 - Profiling Kernels with Nvidia Night Systems</a><a id="Tutorial-2-Profiling-Kernels-with-Nvidia-Night-Systems-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial-2-Profiling-Kernels-with-Nvidia-Night-Systems" title="Permalink"></a></h1><p>Welcome again! This tutorial aims to provide instructions on how to profile CUDA kernels using Nvidia Nsight Systems. The instructions are given based on a cloud Unix system and the VS Code platform (optional).</p><p>Basically, you can accurately measure execution time by:</p><ol><li><p><code>CUDA.@time</code>, a user-friendly measurement tool.</p></li><li><p><code>BenchmarkTools.@benchmark</code>(often used together with <code>CUDA.@sync</code> or <code>CUDA.synchronize()</code>), a robust measurement tool.</p></li></ol><p>For large applications, simple time measurement is not enough. Here, we introduce Nvidia Nsight Systems for profiling CUDA kernels. This method can provide an overview of how and when the GPU was active, thereby helping identify which kernels need optimization.</p><h2 id="Create-Profile"><a class="docs-heading-anchor" href="#Create-Profile">Create Profile</a><a id="Create-Profile-1"></a><a class="docs-heading-anchor-permalink" href="#Create-Profile" title="Permalink"></a></h2><p>Open a new bash terminal and then launch Julia with <code>nsys</code> from Night Systems:</p><pre><code class="nohighlight hljs">$ nsys launch julia</code></pre><p>Enter the package mode and activate the target Julia environment (already configured with the CUDA package):</p><pre><code class="nohighlight hljs">pkg&gt; activate &lt;path-to-your-project&gt;/Project.toml</code></pre><p>Exit the package mode and write your kernels into the Julia command line. Here we use a simple example to show how to profile:</p><pre><code class="nohighlight hljs">julia&gt; using CUDA
julia&gt; a = CUDA.rand(1024, 1024, 1024)
julia&gt; sin.(a) # Run it once to force compilation
julia&gt; CUDA.@profile sin.(a)</code></pre><p>Then a file ending with <code>.nsys-rep</code> (e.g. <code>report1.nsys-rep</code>) will be created in the current directory. This file contains all the profile data.</p><h2 id="View-Profile"><a class="docs-heading-anchor" href="#View-Profile">View Profile</a><a id="View-Profile-1"></a><a class="docs-heading-anchor-permalink" href="#View-Profile" title="Permalink"></a></h2><p>Exit the Julia REPL and retrieve data from the <code>.nsys-rep</code> file.</p><p>There are many ways to customize the view of the profile data. Here, we simply mention three methods that can be directly displayed in your terminal.</p><ol><li>Display default statistics from a report</li></ol><pre><code class="nohighlight hljs">$ nsys stats report1.nsys-rep</code></pre><p>This way will export an SQLite file named <code>report1.sqlite</code> from <code>report1.nsys-rep</code> (assuming it does not already exist). Print the default reports in column format to the console.</p><ol><li>Display specific data from a report</li></ol><pre><code class="nohighlight hljs">$ nsys stats --report cuda_gpu_trace report1.nsys-rep</code></pre><p>This way will export an SQLite file named <code>report1.sqlite</code> from <code>report1.nsys-rep</code> (assuming it does not already exist). Print the report generated by the cuda<em>gpu</em>trace script to the console in column format.</p><ol><li>Generate multiple reports, in multiple formats, output multiple places from a report</li></ol><pre><code class="nohighlight hljs">$ nsys stats --report cuda_gpu_trace --report cuda_gpu_kern_sum --report cuda_api_sum --format csv,column --output .,- report1.nsys-rep</code></pre><p>Export an SQLite file named <code>report1.sqlite</code> from <code>report1.nsys-rep</code> (assuming it does not already exist). Generate three reports. The first, the cuda<em>gpu</em>trace report, will be output to the file <code>report1_cuda_gpu_trace.csv</code> in CSV format. The other two reports, cuda<em>gpu</em>kern<em>sum and cuda</em>api_sum, will be output to the console as columns of data.</p><h2 id="View-Profile-(Optional)"><a class="docs-heading-anchor" href="#View-Profile-(Optional)">View Profile (Optional)</a><a id="View-Profile-(Optional)-1"></a><a class="docs-heading-anchor-permalink" href="#View-Profile-(Optional)" title="Permalink"></a></h2><p>This section is for better visualizing the profile report using the VS Code extension. The VS Code platform is required.</p><p>From the previous section, we created <code>.sqlite</code> and <code>.csv</code> files.</p><p>For the <code>.sqlite</code> file, you can download the &#39;SQLite&#39; extension. Open the Command Palette and enter <code>SQLite: Open Database</code>. Then, you can explore and query the SQLite database from the <code>.sqlite</code> file.</p><p>For the <code>.csv</code> file, you can download the &#39;CSV to Table&#39; extension. Open the Command Palette and enter <code>Convert to table from CSV</code>. Then, you can view the CSV file in table format.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><p>Profiling GPU code in CUDA.jl. https://cuda.juliagpu.org/stable/development/profiling/</p><p>NVIDIA Nsight Systems user guide. https://docs.nvidia.com/nsight-systems/UserGuide/index.html</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../aws_gpu_setup/">« Tutorial 1</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Tuesday 24 September 2024 23:28">Tuesday 24 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
